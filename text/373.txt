Tech Notes: 搬家
Technology
2009-02-01 06:57
花了一晚上时间，把MSN live space里的文章评论迁移到wordpress搭建的blog上来。
单纯从live space到wordpress的搬家是很常见的问题，网上到处都有讨论。但是我其实并不是要进行blog本身的搬家。事实上，在长达一年多的时间里这两个blog都是差不多同步更新的，而我现在要面对的问题是把space下的评论转移到wordpress里的对应文章下面来。既然对我来说这两个地方的意义已经不尽然重合，我想现在大概是时候停止这种手动同步更新的模式了。
于是剩下的问题就是完全技术性的。众所周知，live space的blog格式是最不通用友好的一种（所以对搬家来说也是最难的一种），要想办法直接把评论迁移出来就更是颇费思量的事情。在搜索引擎的帮助下，我最终设计的步骤如下：
首先按照这里的描述，把live space里的全部日志和评论导出为wordpress可以识别的xml格式。这是我所能找到的关于从live space到wordpress搬家的最好的一篇教程。里面实际上本身还牵涉到了若干子步骤，而且，其中对我来说最关键的一部分，即评论的导出，按照作者的描述，其实并不能完美的实现，因为去年12月那次live space的大更新导致所有评论在导出时时间都不精确，而且评论者的电子邮件地址也无法导出。但是无论如何，这是一个差强人意的解决方案。
其次，把目标wordpress站点也导出为xml文件。把这两个xml文件都导入一个临时的wordpress网站，我自己刚好有一个本地用来备份的wordpress站可以用来做这件事。由于两个xml文件来自于两个不同的来源，wordpress并不能识别出哪些文章其实是同一篇，所以这时所有的重复文章都是作为编号不同的文章出现的。
然后，使用这个插件把来自live space的文章下的评论迁移到对应的来自wordpress站点的文章下面。这件事情应该在phpmyadmin下面有更自动化的做法，但是我实在懒得研究sql语法，就用了这种半自动的方式。事实证明，手动劳动量还是相当大的，主要的时间都耗在这一步上了……
最后，在这个临时wordpress站上把来自live space的文章全部删除，把剩下的文章导出为xml文件，再导入回目标wordpress站点。因为文章记录是彼此统一的，所以这时导入的文章并不会重复出现，只是评论被合并了而已。
以上当然未必是最优的方案，而且那个作为中转的wordpress站点也并非必须存在，上述操作完全可以直接在目标wordpress站点上进行。我采用这个中转的设计只是为了以防万一（把风险尽量隔绝在主站之外），而且我也不希望在折腾的过程中忘了手动中止feed更新导致我的所有订阅者的reader里都忽然多出几十篇未读新文章……这是feed输出带来的最大麻烦之一，因为google reader的设计是站点文章的改动会反映在reader里（虽然有时间延迟），但是站点文章删除却不会被反映出来，所以由于意外而被添加的文章是永远都无法从reader里抹去痕迹的。我不知道别人是怎么处理这个问题的，反正我每次对站点做更改的时候都活像打仗一样手忙脚乱争分夺秒，有种在feed爬虫不定期巡逻下偷偷作案的刺激感。
总而言之，问题大致被解决了……暂时的。我相信这样的工作大概很有可能会七八年重来一次，我在开始用QQ的时候就忍不住琢磨过，难道我会一直到十年后都还在用QQ和这些朋友联系么？事实当然证明几年后我就全面换用了MSN，而朋友也换了不止一拨。同样的道理，一直到十年后都还在用wordpress做个人站点显然也是听起来不甚靠谱的一件事情，所以又一次搬家在未来大概也是很难避免的。好在wordpress终究用户广泛，不愁到时候没有教程可看。这个故事告诉我们，保持在大部队里前进（至少不要过于单打独斗）是多么重要啊。
可是这一问题可以被进而推广下去。我会在十年后还上未名么？这个问题的答案多半是悲观的，因为就算我还想上，上面多半也没有我还认识的人了……然而我留在未名上的记录又如何得以搬家——以及搬到什么地方去——呢？
说到底，这是另一种形式的强迫症。向前走的题中应有之意本来就是要相忘于江湖，所以其实这一切努力本来都大可不必。我只是舍不得。——换做十年前的我，大概很难想象我今天会如此执著的保留这些细碎的痕迹（事实上就算今天我也仍然不觉得自己会做这样的事情，虽然我其实正在做……）。我想起来小时候爸爸极其认真地保存我每一次考试的每门课的成绩和比赛的纪录，当时觉得这种行为可笑而乃至于荒唐，现在想想看，我以后也会发展到这样对待我的孩子也说不定。——虽然至少在现在这件事情听起来还是蛮荒诞的。
